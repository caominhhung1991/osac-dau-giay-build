(this["webpackJsonp@coreui/coreui-free-react-admin-template"]=this["webpackJsonp@coreui/coreui-free-react-admin-template"]||[]).push([[9],{1097:function(e,t,n){"use strict";var a=n(396);n.d(t,"b",(function(){return a.a}));var o=n(397);n.d(t,"a",(function(){return o.a}));var u=n(398);n.d(t,"c",(function(){return u.a}))},1099:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var a={DUTRU:{URL:"thucDonDuTru",DATAS:"thucDonDuTru/datas",SETTINGS:{URL:"thucDonDuTru/settings",NHOM_KH:"thucDonDuTru/settings/nhomKhachHang",CAUHINH_DUTRU:"thucDonDuTru/settings/cauHinhDuTru",SHIFT:"thucDonDuTru/settings/shift"}},RECIPES:{URL:"recipes",DATAS:"recipes/datas",CUSTOMER_GROUP:"recipes/customerGroup"}}},1100:function(e,t,n){},1101:function(e,t,n){"use strict";var a=n(1),o=n(3),u=n(0),r=n.n(u),i=n(8),c=n.n(i),l=n(673),s=n(95),d=n(111),f=n(11),v=n(49),m=n(1097),g=function(e){var t,n,i=e.externalWrapperContainer,g=e.mode,b=e.existedCustomers,h=e.viewIds,p=e.style,O=e.userConfig,j=e.userConfigHandle,C=O.coSoId,D=O.customerId,I=O.customerIds,E=(null===j||void 0===j?void 0:j.setConfig)?j.setConfig:f.noop,T=Object(o.a)(i),y=Object(u.useContext)(v.a),S=Object(u.useContext)(v.b),N=null===S||void 0===S||null===(t=S.duTruSettingState)||void 0===t?void 0:t.khachHangs,x=null===S||void 0===S||null===(n=S.duTruSettingState)||void 0===n?void 0:n.khachHangsArray,H=r.a.useMemo((function(){return(x||[]).filter((function(e){return null===e||void 0===e?void 0:e.active}))}),[x]);Object(u.useEffect)((function(){C&&m.b.getsKhachHangsFromBepAnChuyenDi([C])(y)}),[C]);var w=r.a.useMemo((function(){return(H||[]).filter((function(e){return-1===b.indexOf("".concat(e.id))}))}),[H,b]);return r.a.useEffect((function(){if(!w.some((function(e){return"".concat(e.id)==="".concat(D)}))){var e,t=(null===w||void 0===w||null===(e=w[0])||void 0===e?void 0:e.id)||null;E(["customerId"],t)}}),[D,w]),"view"===g?r.a.createElement("div",null,h.map((function(e){var t;return r.a.createElement(l.a,{key:e},(null===N||void 0===N||null===(t=N[e])||void 0===t?void 0:t.name)||e)}))):r.a.createElement(s.a,{title:"Ch\u1ecdn kh\xe1ch h\xe0ng",className:c()(T)},"multiple"===g||"tags"===g?r.a.createElement(d.a,{value:I,style:Object(a.a)({minWidth:"140px"},p),onChange:function(e){return E(["customerIds"],e)},mode:g},w.map((function(e){return r.a.createElement(d.a.Option,{key:e.id,value:"".concat(e.id)},e.name)}))):r.a.createElement(d.a,{value:0===H.length?null:"".concat(D),style:Object(a.a)({width:"140px"},p),onChange:function(e){return E(["customerId"],e)},mode:g},H.map((function(e){return r.a.createElement(d.a.Option,{key:e.id,value:"".concat(e.id)},e.name)}))))};g.defaultProps={style:{},userConfig:{},externalWrapperContainer:[],coSoDispatch:f.noop,mode:null,isfilteredAfterSelect:!1,viewIds:[],existedCustomers:[]},t.a=g},1102:function(e,t,n){"use strict";var a=n(3),o=n(0),u=n.n(o),r=n(95),i=n(111),c=n(11),l=Array(52).fill(1).reduce((function(e,t,n){return[].concat(Object(a.a)(e),[t+n])}),[]),s=function(e){var t=e.userConfig,n=e.userConfigHandle,a=t.weekId,o=(null===n||void 0===n?void 0:n.setConfig)?n.setConfig:c.noop;return u.a.createElement(r.a,{title:"Ch\u1ecdn tu\u1ea7n"},u.a.createElement(i.a,{value:a,style:{width:"110px"},onChange:function(e){return o(["weekId"],e)}},l.map((function(e){return u.a.createElement(i.a.Option,{key:e,value:e},"Tu\u1ea7n ",e)}))))};s.defaultProps={userConfig:{}},t.a=s},1164:function(e,t,n){"use strict";n.r(t);var a=n(6),o=(n(1100),n(0)),u=n.n(o),r=n(16),i=n.n(r),c=n(196),l=n(103),s=n(13),d=n(563),f=n(11),v=n(2),m=n(47),g=n(14),b=n.n(g),h=n(8),p=n.n(h),O=n(53),j={tag:O.e,"aria-label":b.a.string,className:b.a.string,cssModule:b.a.object,role:b.a.string},C=function(e){var t=e.className,n=e.cssModule,a=e.tag,o=Object(m.a)(e,["className","cssModule","tag"]),r=Object(O.c)(p()(t,"btn-toolbar"),n);return u.a.createElement(a,Object(v.a)({},o,{className:r}))};C.propTypes=j,C.defaultProps={tag:"div",role:"toolbar"};var D=C,I={tag:O.e,"aria-label":b.a.string,className:b.a.string,cssModule:b.a.object,role:b.a.string,size:b.a.string,vertical:b.a.bool},E=function(e){var t=e.className,n=e.cssModule,a=e.size,o=e.vertical,r=e.tag,i=Object(m.a)(e,["className","cssModule","size","vertical","tag"]),c=Object(O.c)(p()(t,!!a&&"btn-group-"+a,o?"btn-group-vertical":"btn-group"),n);return u.a.createElement(r,Object(v.a)({},i,{className:c}))};E.propTypes=I,E.defaultProps={tag:"div",role:"group"};var T=E,y=n(1055),S=n(259),N=n(472),x=n(624),H=n(49),w=n(30),k=n(157),A=n(1101),M=n(1102),P=n(468),R=n(181),U=n(125),L=function(e){var t=e.setConfig,n=e.thucDonConfig,o=e.userConfigHandle,r=e.weekId,i=e.yearId,c=e.coSoId,l=u.a.useMemo((function(){return new U.b}),[]),s=[{element:u.a.createElement(k.NavLink,{to:l.URLS.bepAnChuyenDi},"Th\u1ef1c \u0110\u01a1n")},{element:u.a.createElement(P.a,{defaultCantinId:c,style:{minWidth:"100px"},selectCantin:function(e){return t(["coSoId"],e)},manualCoSoArray:[R.b.xuongDauGiay],isCoSo:!0})},{element:u.a.createElement(A.a,{userConfig:n,userConfigHandle:o,style:{width:"140px"}})},{element:u.a.createElement(M.a,{userConfig:n,userConfigHandle:o})},{text:"Tu\u1ea7n ".concat(r,"-").concat(i)},{element:u.a.createElement(k.Link,{className:["btn btn-sm","btn-outline-danger"].join(" "),to:"/gopDuTru/gopDuTruItem"},"Show all")}],d=Object(w.c)({breadcrumbs:s,buttons:[]}),f=Object(a.a)(d,1)[0];return(null===f||void 0===f?void 0:f.getRender)&&f.getRender()},G=n(1097),K=n(43),z=n(3),F=n(9),W=n(1),Y=n(680),_=n(664),B=n(7),J=n(1099),q=function(e){var t=e.shiftConfigs,n=e.tongHopOfShifts,r=e.customerGroup,i=e.coSoId,c=e.customerId,l=e.yearId,s=e.weekId,d=e.dayId,v=e.isInput,m=e.setIsInput,g=Object(o.useContext)(H.a),b=g.firebase,h=g.duTruDispatch,p=Object(o.useContext)(H.b).duTruState,O=null===p||void 0===p?void 0:p.isLoading,j=Object(o.useState)([]),C=Object(a.a)(j,2),D=C[0],I=C[1],E=Object(o.useState)([]),T=Object(a.a)(E,2),y=T[0],S=T[1];Object(o.useEffect)((function(){var e=[];if(r&&t.length>0){var a=(null===r||void 0===r?void 0:r.giaPhanAn)||0,o=t.reduce((function(e,t){var a,o=t.id;return e+((null===n||void 0===n||null===(a=n[o])||void 0===a?void 0:a.tongPhanAn)||0)}),0),u=o*a,i=t.reduce((function(e,t){var n=null===p||void 0===p?void 0:p["tongHopDuTruData/".concat(c,"/").concat(null===t||void 0===t?void 0:t.id)];return e+((null===n||void 0===n?void 0:n.tongChiPhi)||0)}),0);e=[Object(W.a)(Object(W.a)({item:"T\u1ed5ng ph\u1ea7n"},t.reduce((function(e,t){var a,o=t.id,u=(null===n||void 0===n||null===(a=n[o])||void 0===a?void 0:a.tongPhanAn)||0;return Object(W.a)(Object(W.a)({},e),{},Object(F.a)({},o,u))}),{})),{},{tong:o}),Object(W.a)(Object(W.a)({item:"T\u1ed5ng c. ph\xed"},t.reduce((function(e,t){var n=t.id,a=null===p||void 0===p?void 0:p["tongHopDuTruData/".concat(c,"/").concat(n)],o=(null===a||void 0===a?void 0:a.tongChiPhi)||0;return Object(W.a)(Object(W.a)({},e),{},Object(F.a)({},n,o))}),{})),{},{tong:i||0}),Object(W.a)(Object(W.a)({item:"Doanh thu"},t.reduce((function(e,t){var o,u=t.id,r=((null===n||void 0===n||null===(o=n[u])||void 0===o?void 0:o.tongPhanAn)||0)*a;return Object(W.a)(Object(W.a)({},e),{},Object(F.a)({},u,r))}),{})),{},{tong:u}),Object(W.a)(Object(W.a)({item:"Cost"},t.reduce((function(e,t){var o,u=t.id,r=null===p||void 0===p?void 0:p["tongHopDuTruData/".concat(c,"/").concat(u)],i=(null===r||void 0===r?void 0:r.tongChiPhi)||0,l=((null===n||void 0===n||null===(o=n[u])||void 0===o?void 0:o.tongPhanAn)||0)*a;return Object(W.a)(Object(W.a)({},e),{},Object(F.a)({},u,Math.round(i/l*100*100)/100))}),{})),{},{tong:Math.round(i/u*100*100)/100})]}I(e)}),[p,c,d,t,r,n]),Object(o.useEffect)((function(){var e;return e=setTimeout((function(){var e=t.map((function(e){var t=null===e||void 0===e?void 0:e.id;return{dataIndex:e.id,title:e.name,align:"center",width:150,className:"text-small",render:function(e,a){var o;switch(a.item){case"T\u1ed5ng ph\u1ea7n":var r=(null===n||void 0===n||null===(o=n[t])||void 0===o?void 0:o.tongPhanAn)||0;return"tongDoanhThu"===(null===v||void 0===v?void 0:v.type)?u.a.createElement(Y.a,{defaultValue:0!==r?r:"",onBlur:function(e){return N(e,t)},size:"small",autoFocus:!0}):u.a.createElement("div",{className:"hoverClass",onClick:function(){return m({type:"tongDoanhThu"})}},r?Object(B.d)(r):"--");case"Cost":return u.a.createElement("strong",{className:"text-danger"},e,"%");default:return e&&u.a.createElement("div",null,Object(B.d)(e))}}}}));e=e.filter((function(e){var t=e.dataIndex,n=null===p||void 0===p?void 0:p["tongHopDuTruData/".concat(c,"/").concat(t)];return n&&n.tongChiPhi>0}));var a={dataIndex:"tong",title:"T\u1ed5ng",className:"text-small",align:"center",width:120,render:function(e,t){return"Cost"===t.item?u.a.createElement("strong",{className:"text-danger"},e,"%"):e&&u.a.createElement("strong",null,Object(B.d)(e))}},o=[{dataIndex:"item",title:"",width:120,className:"text-small"}].concat(Object(z.a)(e),[a]);S(o)}),300),function(){e&&clearTimeout(e)}}),[p,c,t,n,v]);var N=function(e,t){var a,o=e.target.value,u=Number(o),r=(null===n||void 0===n||null===(a=n[t])||void 0===a?void 0:a.tongPhanAn)||0;if(!Object(f.isEqual)(r,u)){h({type:"start"});var v=[J.a.DUTRU.DATAS,i,l,s,"tongHopOfDays",d,"customerIds",c,"shiftIds",t,"tongPhanAn"];b.db.ref(v.join("/")).set(u).then((function(){h({type:"end"}),m({})}))}};return u.a.createElement("div",{className:"col-lg-7 mb-2"},u.a.createElement(_.a,{loading:O,rowKey:"item",columns:y,dataSource:D,pagination:!1,size:"small",bordered:!0,footer:null,scroll:{x:220+120*t.length}}))};q.defaultProps={shiftConfigs:[],tongHopChiPhi:{}};var V=q,Q=n(464),X=n(127),Z=u.a.lazy((function(){return n.e(10).then(n.bind(null,1162))})),$=Object(c.a)(Object(l.b)((function(){return{}}),{getRecipes:N.c,getDutrus:x.d,getDutru:x.c,updateDutru:x.g,updateDuTruSoPhanAn:x.f,updateComments:x.e,getRecipePrice:N.b,getDieuChinhs:x.b}));t.default=$((function(e){var t=u.a.useMemo((function(){return new K.a}),[]),n=Object(Q.a)({child:["thucDonDuTruConfig"]}),r=Object(a.a)(n,1)[0],c=(null===r||void 0===r?void 0:r.thucDonDuTruConfig)||{},l=c.coSoId,v=c.customerId,m=c.yearId,g=c.weekId,b=c.dayId,h=(null===r||void 0===r?void 0:r.setConfig)?r.setConfig:f.noop,p=Object(X.b)(),O=Object(a.a)(p,2),j=O[0],C=O[1],I=Object(o.useContext)(H.a),E=I.firebase,N=Object(o.useContext)(H.b).duTruSettingState,x=(null===N||void 0===N?void 0:N[K.a.collections.shift.datasArray])||[],w=(null===N||void 0===N?void 0:N[K.a.collections.recipeKind.datas])||{},k=Object(o.useState)({}),A=Object(a.a)(k,2),M=A[0],P=A[1],R=Object(o.useState)({}),U=Object(a.a)(R,2),z=U[0],F=U[1],W=Object(o.useState)({}),Y=Object(a.a)(W,2),_=Y[0],B=Y[1],J=Object(o.useState)({}),q=Object(a.a)(J,2),$=q[0],ee=q[1],te=u.a.useMemo((function(){var e,t;return(null===N||void 0===N||null===(e=N.khachHangs)||void 0===e||null===(t=e[v])||void 0===t?void 0:t.soMonMan)||0}),[v,N]),ne=u.a.useMemo((function(){return g&&m?Object(d.a)({week:g,year:m}):{}}),[g,m]);return Object(o.useEffect)((function(){l&&G.b.getShifts([l])(I)}),[l]),Object(o.useEffect)((function(){if(l&&v){var e=["thucDonDuTru/settings/nhomKhachHang",l];E.db.ref(e.join("/")).once("value",(function(e){var n=e.val()||{},a=t.getCustomerGroup(n,v);P(a)}))}}),[l,v]),Object(o.useEffect)((function(){var e=M.id,t=null;if(e){var n=["recipes/customerGroup",e];(t=E.db.ref(n.join("/"))).on("value",(function(e){var t=e.val()||{};F(t)}))}return function(){t&&t.off()}}),[M]),Object(o.useEffect)((function(){var e=null;if(l&&v&&m&&g&&b){var t=["thucDonDuTru/datas",l,m,g,"tongHopOfDays",b,"customerIds",v,"shiftIds"];(e=E.db.ref(t.join("/"))).on("value",(function(e){var t=e.val()||{};B(t)}))}return function(){e&&e.off()}}),[l,v,m,g,b]),Object(o.useEffect)((function(){return G.b.getsRecipeKind()(I),G.c.getRecipes()(I),C.getNguyenLieus(),function(){C.stopListenNguyenLieu()}}),[]),u.a.createElement(u.a.Fragment,null,u.a.createElement(L,{setConfig:h,thucDonConfig:c,userConfigHandle:r,weekId:g,yearId:m,coSoId:l}),u.a.createElement("div",{className:"row mt-2"},u.a.createElement(V,{customerGroup:M,shiftConfigs:x,customerId:v,coSoId:l,yearId:m,weekId:g,dayId:b,isInput:$,setIsInput:ee,tongHopOfShifts:_}),u.a.createElement("div",{className:"col-lg-5"},u.a.createElement(D,{className:""},u.a.createElement(T,{size:"sm"},s.c.getArray().map((function(e){var t=i()().format("DD-MM"),n=i()().format("YYYY"),a=t===ne[e.enName]&&"".concat(n)==="".concat(m)?{border:"1px solid red",color:"red"}:{};return u.a.createElement(y.a,{key:e.id,onClick:function(){return h(["dayId"],e.id)},color:"warning",outline:b!==e.id,style:a},u.a.createElement("div",null,e.name),u.a.createElement("div",null,ne[e.enName]))})))))),u.a.createElement("div",null,x.map((function(e){return u.a.createElement(o.Suspense,{key:e.id,fallback:u.a.createElement(S.a,{className:"osac-spin"})},u.a.createElement(Z,{soMonMan:te,duTruSettingState:N,duLieuChungState:j,tongHopOfShifts:_,shiftConfig:e,recipeKinds:w,userConfig:c,userConfigHandle:r,customerGroup:M,nguyenLieusTrongMonAn:z,isInput:$,setIsInput:ee}))}))))}))}}]);